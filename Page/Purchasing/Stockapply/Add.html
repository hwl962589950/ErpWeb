<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>采购请购单新增</title>
    <script src="/FsLayui/common.js"></script>
    <style>
        .layui-table-cell {
            height: 100%;
            max-width: 100%;
        }
    </style>
</head>



<body>
    <!--


{"Appid":"001","Appdate":"2019-08-26T00:00:00","Apptype":"","Appcircs":3,"Appperson":"请购人员","Apppersonid":"","Appdept":"傻逼部门","Appdeptid":"A001","Appmaker":"制单人员","Appauditingperson":"复核人员","Appauditing":"无效","Stockapplyname":"","Enables":1,"Safetyone":"","Safetytwo":"","Extend0":null,"Extend1":null,"Extend2":null,"Extend3":null,"Extend4":null}}}

    -->
    <div class="site-text site-block">
        <form class="layui-form layui-form-pane" action="" groupId="fsDatagrid" isLoad="1" method="POST"
            loadUrl="/api/Stockapply/Get" id="Materiel" onkeydown="if(event.keyCode==13){return false}" >
            <input id="id" name="MaterielId" type="hidden" />
            <div class="layui-form-item">
                <label class="layui-form-label required">采购请购类型</label>
                <div class="layui-input-inline">
                    <input type="text" name="Apptype" required="" lay-verify="required" placeholder="请输入物料名称"
                        autocomplete="off" class="layui-input">
                </div>

                <label class="layui-form-label">单据日期</label>
                <div class="layui-input-inline">
                    <input type="text" name="Appdate" autocomplete="off" class="layui-input fsDate"
                        dateType="datetime" />
                </div>


            </div>

            <div class="layui-form-item">
                <label class="layui-form-label required">单况</label>
                <div class="layui-input-inline">
                    <input type="text" name="Appauditing" required="" lay-verify="required" autocomplete="off"
                        class="layui-input">
                </div>


                <label class="layui-form-label required">单据号码</label>
                <div class="layui-input-inline">
                    <input type="text" name="Appid" id="Appid" required="" lay-verify="required" autocomplete="off"
                        class="layui-input">
                </div>
            </div>



            <div class="layui-tab">
                <ul class="layui-tab-title">
                    <li class="layui-this">内容</li>
                    <li>备注</li>

                </ul>
                <div class="layui-tab-content">

                    <div class="layui-tab-item layui-show">

                        <div class="layui-col-md12">
                            <div class="layui-card">
                                <div class="layui-card-body">

                                    <div>
                                        <button class="layui-btn  layui-btn-sm layui-btn-blue FsMyAddRow"
                                            function="topAddRow" tableId="fsDatagrid" topMode="GetData"
                                            topUrl="Queny.html" topWidth="700px" topHeight="275px" isMaxWindow=""
                                            topTitle="新增信息">
                                            <i class="layui-icon">&#xe654;</i>选择弹窗物料
                                        </button>


                                        <button class="layui-btn layui-btn-blue FsRetrieve" function="Retrieve"
                                            isSelect="1">
                                            <i class="layui-icon"></i>取回
                                        </button>






                                    </div>

                                    <table id="fsDatagrid" isTotalRow="1" lay-filter="fsDatagrid" groupId="fsDatagrid"
                                        class="fsDatagrid" method="Get" url="/api/StockapplyDetails/StockapplyQueny"
                                        defaultform="query_form" isLoad="1" isTotalRow="1" cellMinWidth="50"
                                        inputs="Appid:" isPage="0" width="900" height="500-100" style="display: none">
                                    </table>

                                    <div class="fsDatagridCols">
                                        <p type="numbers" title="拦号" width="100"></p>
                                        <p field="Apdmateridlid" title="物料编号" align="center" width="100"
                                            totalRowText="合计:"></p>
                                        <p field="Apdmateridlname" title="物料名称" align="center" width="200">
                                        </p>
                                        <p field="Apdmodel" title="规格型号" align="center" dict="materielType" width="100">
                                        </p>
                                        <p field="Apdunit" title="单位名称" align="center" width="100"></p>
                                        <p field="Apdnum" title="数量" align="center"  width="50" edit="text" oninput="value=value.replace(/[^\d]/g,'')"
                                            totalRow="true"></p>
                                        <p field="Apdstandardprice" title="标准进加" align="center" width="100"
                                            totalRow="true"></p>
                                        <p field="Apdstandardmoney" title="标准金价金额" align="center" width="150"
                                            totalRow="true"></p>
                                        <p field="Apdprice" title="单价" align="center" width="100" totalRow="true"></p>
                                        <p field="Apdintomoney" title="进价金额" align="center" width="100"></p>
                                        <p field="Apddemanddate" title="需求日期" formatType="data" templet="#time"
                                            edit="text" align="center" width="200"></p>
                                        <p field="Apdstockdate" title="建议采购日期" formatType="data" align="center"
                                            width="200"></p>
                                        <p field="Apdnotnum" title="未采购数量" align="center" width="100" totalRow="true">
                                        </p>
                                        <p field="Apdremark" title="分录备注" align="center" width="100"></p>
                                        <p field="Apdoriginid" title="来源单别" align="center" width="100"></p>
                                        <p field="Apdorigintype" title="来源单号" align="center" width="200">
                                        </p>
                                        <p fixed="right" align="center" toolbar="#barDemo" title="操作" width="100"></p>

                                        <p field="Extend0" hide="true" title="扩展字段"></p>
                                        <p field="Extend1" hide="true" title="扩展字段"></p>
                                        <p field="Extend2" hide="true" title="扩展字段"></p>
                                        <p field="Extend3" hide="true" title="扩展字段"></p>
                                        <p field="Extend4" hide="true" title="扩展字段"></p>

                                    </div>
                                    <script type="text/html" id="barDemo">
                                        <div class="layui-btn-container">
                                             <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delRow" isConfirm="1" confirmMsg="是否确定删除当前记录？">删除</a>
                                        </div>
                                     </script>


                                    <script type="text/html" id="time">
                                          <input type="text" name="createdTime" autocomplete="off" class="layui-input fsDate" dateType="datetime" />
                                    </script>



                                </div>
                            </div>
                        </div>





                    </div>
                    <div class="layui-tab-item">

                        <div class="layui-inline">
                            <label class="layui-form-mid">备注：</label>

                            <textarea class="layui-textarea"></textarea>

                        </div>

                    </div>


                </div>


            </div>

            <div class="layui-inline">
                <label class="layui-form-mid">请购人员：</label>
                <div class="layui-input-inline" style="width: 100px;">
                    <input type="text" name="" autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-inline">
                <label class="layui-form-mid">请购部门：</label>
                <div class="layui-input-inline" style="width: 100px;">
                    <input type="text" name="" autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-inline">
                <label class="layui-form-mid">制单人员：</label>
                <div class="layui-input-inline" style="width: 100px;">
                    <input type="text" name="" autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-inline">
                <label class="layui-form-mid">审核人员：</label>
                <div class="layui-input-inline" style="width: 100px;">
                    <input type="text" name="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <button class="layui-btn fsAdd"      function="save" groupId="fsDatagrid" url="/api/Stockapply/AddStockapply"
                method="POST">
                <i class="layui-icon">&#xe609;</i>新增采购请购单
            </button>

            <button class="layui-btn fsEdit" function="save" lay-filter="edit" groupId="fsDatagrid"
                url="/api/Stockapply/UpdStockapply" method="POST">
                <i class="layui-icon">&#xe609;</i>修改采购请购单
            </button>

          
            

        </form>
        <div>
                <div class="layui-btn-group">            
                        <ul class="layui-nav layui-bg-green btnz" lay-filter="" style="font-size: 12px;border-radius: 0px;float: right;padding:0px 0px 0px 0px;margin-left: 2px;">
                            <li class="layui-nav-item" style="line-height: 30px;font-size: 12px;">
                                <a href="javascript:;" style="color:white;font-size: 12px;padding: 0px 30px 0px 20px;">功能<span class="layui-nav-more" style="right: 10px;font-size: 12px;"></span></a>
                                <dl class="layui-nav-child" style="top: 30px;line-height: 31px;padding: 0px 0px 0px 0px;"> <!-- 二级菜单 -->
                                    <dd><button class="layui-btn layui-btn layui-btn-sm layui-btn-fluid" id="btn_cjb">单况状态切换</button></dd>
                                </dl>
                            </li>
                        </ul>
                </div>

                <div class="layui-btn-group">            
                        <ul class="layui-nav layui-bg-green btnz" lay-filter="" style="font-size: 12px;border-radius: 0px;float: right;padding:0px 0px 0px 0px;margin-left: 2px;">
                            <li class="layui-nav-item" style="line-height: 30px;font-size: 12px;">
                                <a href="javascript:;" style="color:white;font-size: 12px;padding: 0px 30px 0px 20px;">转单<span class="layui-nav-more" style="right: 10px;font-size: 12px;"></span></a>
                                <dl class="layui-nav-child" style="top: 30px;line-height: 31px;padding: 0px 0px 0px 0px;"> <!-- 二级菜单 -->
                                    <dd><button class="layui-btn layui-btn layui-btn-sm layui-btn-fluid" id="btn_cjb">销售订单转入</button></dd>
                                </dl>
                            </li>
                        </ul>
                </div>


        </div>

    </div>
    
</body>

</html>
<script>
    layui.fsRequestSuccessCallback.add = function (result, _this, fsCommon) {
        console.log(result);
        if (result.flage) {
            fsCommon.successMsg("新增成功");
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            window.parent.location.reload();   //刷新父界面
            parent.layer.close(index);    //关闭弹出层

        } else {
            fsCommon.successMsg("新增失败");
        }
    }

    layui.use(['table', 'fsCommon'], function () {
        var table = layui.table,
            fsDatagrid = layui.fsDatagrid,
            fsCommon = layui.fsCommon;

        //监听行单击事件
        table.on('rowDouble(fsDatagrid)', function (obj) {
            console.log(obj.tr) //得到当前行元素对象
            console.log(obj.data) //得到当前行数据});
        });


          //监听单元格编辑
        table.on('edit(fsDatagrid)', function(obj){
            var value = obj.value //得到修改后的值
            ,data = obj.data //得到所在行所有键值
            ,field = obj.field; //得到字段

            switch(field){
                case "Apdnum":
                GetDatagrId('fsDatagrid').refreshStatic();
                    break;
                case "Apddemanddate":
                    fsCommon.confirm("时间提示","是否把全部需求日期更改",function(index){
                        top.layer.close(index);
                        var objs= GetDatagrId('fsDatagrid').getData();
                        for(var i=0;i<objs.length;i++){
                            objs[i].Apddemanddate=obj.value;
                        }
                        GetDatagrId('fsDatagrid').refreshStatic();
                        });
                        break;
                    }

                    });

            
      

        var urlParam = fsCommon.getUrlParam();
        var _mode = urlParam["_mode"];
        if (_mode == "edit") {
            $("#Appid").attr("readonly", "")
        }

    });




    //取回数据回调
    var SelectData = function (obj) {
        for (var i = 0; i < obj.length; i++) {
            GetDatagrId("fsDatagrid").addRow(obj[i]);
        }
    }



</script>